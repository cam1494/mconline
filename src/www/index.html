<script type="text/javascript" src="js/browserfs.js"></script>
<script type="text/javascript" src="doppio.js"></script>
<script type="text/javascript">
    // Wrap in a closure; don't pollute the global namespace.
    (function() {
      var mfs = new BrowserFS.FileSystem.MountableFileSystem(),
          fs = BrowserFS.BFSRequire('fs');
      BrowserFS.initialize(mfs);
      // Temporary storage.
      mfs.mount('/tmp', new BrowserFS.FileSystem.InMemory());
      // 10MB of writable storage
      // Use BrowserFS's IndexedDB file system for more storage.
      mfs.mount('/gamedir', new BrowserFS.FileSystem.LocalStorage());
      // The first argument is the filename of the listings file
      // The second argument is the relative URL to the folder containing the listings file
      // and the data it indexes.
      mfs.mount('/sys', new BrowserFS.FileSystem.XmlHttpRequest('listings.json', ''));
    })();

    process = BrowserFS.BFSRequire('process');
    process.initializeTTYs();

    stdoutBuffer = '';
    process.stdout.on('data', function(data) {
    stdoutBuffer += data.toString();
    var newlineIdx;
    while ((newlineIdx = stdoutBuffer.indexOf("\n")) > -1) {
        console.log(stdoutBuffer.slice(0, newlineIdx));
        stdoutBuffer = stdoutBuffer.slice(newlineIdx + 1);
    }
    });

    stderrBuffer = '';
    process.stderr.on('data', function(data) {
    stderrBuffer += data.toString();
    var newlineIdx;
    while ((newlineIdx = stderrBuffer.indexOf("\n")) > -1) {
        console.error(stderrBuffer.slice(0, newlineIdx));
        stderrBuffer = stderrBuffer.slice(newlineIdx + 1);
    }
    });

    function runGame() {
        // Start the JVM.
        new Doppio.VM.JVM({
            // '/sys' is the path to a directory in the BrowserFS file system with:
            // * vendor/java_home/*
            doppioHomePath: '/sys',
            // Add the paths to your class and JAR files in the BrowserFS file system
            classpath: [
                "/sys/libraries/net/sf/jopt-simple/jopt-simple/4.6/jopt-simple-4.6.jar",
                "/sys/libraries/com/paulscode/codecjorbis/20101023/codecjorbis-20101023.jar",
                "/sys/libraries/com/paulscode/codecwav/20101023/codecwav-20101023.jar",
                "/sys/libraries/com/paulscode/libraryjavasound/20101123/libraryjavasound-20101123.jar",
                "/sys/libraries/com/paulscode/librarylwjglopenal/20100824/librarylwjglopenal-20100824.jar",
                "/sys/libraries/com/paulscode/soundsystem/20120107/soundsystem-20120107.jar",
                "/sys/libraries/io/netty/netty-all/4.0.23.Final/netty-all-4.0.23.Final.jar",
                "/sys/libraries/com/google/guava/guava/17.0/guava-17.0.jar",
                "/sys/libraries/org/apache/commons/commons-lang3/3.3.2/commons-lang3-3.3.2.jar",
                "/sys/libraries/commons-io/commons-io/2.4/commons-io-2.4.jar",
                "/sys/libraries/commons-codec/commons-codec/1.9/commons-codec-1.9.jar",
                "/sys/libraries/net/java/jinput/jinput/2.0.5/jinput-2.0.5.jar",
                "/sys/libraries/net/java/jutils/jutils/1.0.0/jutils-1.0.0.jar",
                "/sys/libraries/com/google/code/gson/gson/2.2.4/gson-2.2.4.jar",
                "/sys/libraries/org/apache/commons/commons-compress/1.8.1/commons-compress-1.8.1.jar",
                "/sys/libraries/org/apache/httpcomponents/httpclient/4.3.3/httpclient-4.3.3.jar",
                "/sys/libraries/commons-logging/commons-logging/1.1.3/commons-logging-1.1.3.jar",
                "/sys/libraries/org/apache/httpcomponents/httpcore/4.3.2/httpcore-4.3.2.jar",
                "/sys/libraries/org/apache/logging/log4j/log4j-api/2.0-beta9/log4j-api-2.0-beta9.jar",
                "/sys/libraries/org/apache/logging/log4j/log4j-core/2.0-beta9/log4j-core-2.0-beta9.jar",
                "/sys/lwjgl",
                "/sys/classes"
            ],
            nativeClasspath: [
                "/sys/natives"
            ]
        }, function(err, jvm) {
            jvm.runClass('com.bitepp.obcraft.Start', [], function(exitCode) {
                if (exitCode === 0) {
                    console.log("Exited successfully");
                } else {
                    console.log("Exited with error");
                }
            });
        });
    }
</script>
